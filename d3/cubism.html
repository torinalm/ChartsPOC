
<!DOCTYPE html>
<meta charset="utf-8">
<link rel="stylesheet" type="text/css" href="cubism.css">
<script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="https://square.github.io/cubism/cubism.v1.min.js"></script>
<body id="demo">
<script>

// var context = cubism.context()
//     .serverDelay(new Date(2012, 4, 2) - Date.now())
//     .step(864e5)
//     .size(1280)
//     .stop();
//
// d3.select("#demo").selectAll(".axis")
//     .data(["top", "bottom"])
//   .enter().append("div")
//     .attr("class", function(d) { return d + " axis"; })
//     .each(function(d) { d3.select(this).call(context.axis().ticks(12).orient(d)); });
//
// d3.select("body").append("div")
//     .attr("class", "rule")
//     .call(context.rule());

var barWidth = 40;
var w = window.innerWidth;
var h = window.innerHeight;
var radius = 15;
var padding = 2 * radius;

var format = d3.time.format("%Y-%d-%m");

var svg = d3.select("body")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

var data = d3.csv("GlobalLandTemperaturesByCountry.csv", function(d) {
  d.forEach(function(d){
    d.AverageTemperature = +d.AverageTemperature;
    d.AverageTemperatureUncertainty = +d.AverageTemperatureUncertainty;
    d.dt = format.parse(d.dt);
  })

  var sites = d;
  // sites.concat(d.slice(10000,10300));
  console.log(sites);

  var x = d3.scale.linear().domain([d3.min(d, function(d) { return d.dt.getFullYear();}), d3.max(d, function(d) { return d.dt.getFullYear();})]).range([padding, w - padding]);
  var y = d3.scale.linear().domain([0, d3.max(d, function(d) { return d.AverageTemperature; })])
          .rangeRound([h - padding, padding]);

  var xAxis = d3.svg.axis()
    .orient("bottom")
    .scale(x);
  var yAxis = d3.svg.axis()
    .orient("left")
    .scale(y);


  var circles = svg.selectAll("circle")
    .data(sites)
    .enter()
    .append("circle")
    .attr("cx", function(d) { return x(d.dt.getFullYear()); })
    .attr("cy", function(d) { return y(d.AverageTemperature); })
    .attr("r", function(d) { return (d.dt.getFullYear() / 150);})
    .attr("fill", function(d) {return "#" + d.dt.getFullYear() + "0f";})
    .append("title")
    .text(function(d) {return d.AverageTemperature;});

  svg.append("g")
    .attr("class", "axis")
    .attr("transform", "translate(0, " + (h - padding) + ")")
    .call(xAxis);

  svg.append("g")
    .attr("class", "axis")
    .attr("transform", "translate("+ padding +",0)")
    .call(yAxis);
});

// d3.select("body").selectAll(".horizon")
//     .data(["AAPL", "BIDU", "SINA", "GOOG", "MSFT", "YHOO", "ADBE", "REDF", "INSP", "IACI", "AVID", "CCUR", "DELL", "DGII", "HPQ", "SGI", "SMCI", "SNDK", "SYNA"].map(stock))
//   .enter().insert("div", ".bottom")
//     .attr("class", "horizon")
//   .call(context.horizon()
//     .format(d3.format("+,.2p")));
//
// d3.select("body").selectAll(".horizon")
//     .data([
//       "LandAverageTemperature",
//       "LandAverageTemperatureUncertainty",
//       "LandMaxTemperature",
//       ""
//     ].map(stock))
//   .enter().insert("div", ".bottom")
//     .attr("class", "horizon")
//   .call(context.horizon()
//     .format(d3.format("+,.2p")));

// context.on("focus", function(i) {
//   d3.selectAll(".value").style("right", i == null ? null : context.size() - i + "px");
// });
//
// // Replace this with context.graphite and graphite.metric!
// function stock(name) {
//   var format = d3.time.format("%d-%b-%y");
//   return context.metric(function(start, stop, step, callback) {
//     d3.csv("stocks/" + name + ".csv", function(rows) {
//       rows = rows.map(function(d) { return [format.parse(d.Date), +d.Open]; }).filter(function(d) { return d[1]; }).reverse();
//       var date = rows[0][0], compare = rows[400][1], value = rows[0][1], values = [value];
//       rows.forEach(function(d) {
//         while ((date = d3.time.day.offset(date, 1)) < d[0]) values.push(value);
//         values.push(value = (d[1] - compare) / compare);
//       });
//       callback(null, values.slice(-context.size()));
//     });
//   }, name);
// }

</script>
</body>
